<script setup lang="ts">
import { useVulnerabilitiesFixedPost } from '@composables/useVulnerabilities'
import { VButton } from '@components'
import { notify } from '@kyvg/vue3-notification'

const { loading, error, postVulnerabilityFixed } = useVulnerabilitiesFixedPost()

const props = defineProps<{
    idVulnerability: string
    close: () => void
}>()

const handleButton = async () => {
    await postVulnerabilityFixed([
        {
            cve_id: props.idVulnerability,
            fixed: true,
        },
    ])
    if (!error.value) {
        notify({
            title: `Vulnerability with ID ${props.idVulnerability} has been fixed!`,
            type: 'success',
        })
        props.close()
    }
}
</script>

<template>
    <div class="flex flex-col gap-4 items-center justify-center">
        Are you sure you want to change the status of the vulnerability with ID {{ idVulnerability }}?
        <div class="flex gap-2 items-center justify-center">
            <VButton variant="secondary" @click="close">No</VButton>
            <VButton @click="handleButton" :loading="loading">Yes</VButton>
        </div>
    </div>
</template>
